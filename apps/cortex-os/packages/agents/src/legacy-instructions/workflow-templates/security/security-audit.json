{
  "name": "Comprehensive Security Audit Workflow",
  "version": "1.0.0",
  "description": "Multi-layered security assessment including SAST, DAST, dependency scanning, and threat modeling",
  "category": "security",
  "variables": {
    "targetApplication": "web application",
    "scanDepth": "comprehensive",
    "reportFormat": "json",
    "complianceFramework": "OWASP",
    "environmentType": "production"
  },
  "agents": [
    {
      "id": "security-scanner",
      "type": "security",
      "name": "Security Scanner",
      "capabilities": [
        "vulnerability_scanning",
        "sast",
        "dast",
        "compliance_checking"
      ],
      "config": {
        "scanTools": ["sonarqube", "bandit", "eslint-security", "semgrep"],
        "reportFormat": "${reportFormat}"
      }
    },
    {
      "id": "dependency-auditor",
      "type": "security",
      "name": "Dependency Auditor",
      "capabilities": [
        "dependency_analysis",
        "sbom_generation",
        "license_compliance"
      ],
      "config": {
        "scanners": ["npm-audit", "pip-audit", "snyk"],
        "generateSBOM": true
      }
    },
    {
      "id": "security-analyst",
      "type": "analyst",
      "name": "Security Analyst",
      "capabilities": [
        "threat_modeling",
        "risk_assessment",
        "penetration_testing"
      ],
      "config": {
        "methodology": "STRIDE",
        "riskFramework": "CVSS"
      }
    },
    {
      "id": "compliance-officer",
      "type": "reviewer",
      "name": "Compliance Officer",
      "capabilities": [
        "compliance_review",
        "policy_enforcement",
        "audit_reporting"
      ],
      "config": {
        "frameworks": ["${complianceFramework}", "SOC2", "ISO27001"]
      }
    }
  ],
  "tasks": [
    {
      "id": "static-analysis",
      "name": "Static Application Security Testing",
      "type": "security-scan",
      "description": "Perform comprehensive SAST scanning of source code",
      "assignTo": "security-scanner",
      "priority": "urgent",
      "timeout": 1800000,
      "input": {
        "codebase": "${targetApplication}",
        "scanDepth": "${scanDepth}",
        "rulesets": ["owasp-top-10", "cwe-top-25"]
      }
    },
    {
      "id": "dependency-scan",
      "name": "Dependency Vulnerability Assessment",
      "type": "dependency-scan",
      "description": "Audit all dependencies for known vulnerabilities and license issues",
      "assignTo": "dependency-auditor",
      "priority": "high",
      "timeout": 900000,
      "input": {
        "packageFiles": "auto-detect",
        "includeDev": true,
        "licenseCheck": true
      }
    },
    {
      "id": "secrets-scan",
      "name": "Secrets Detection",
      "type": "security-scan",
      "description": "Scan for hardcoded secrets, API keys, and credentials",
      "assignTo": "security-scanner",
      "priority": "urgent",
      "timeout": 600000,
      "input": {
        "scanTarget": "repository",
        "includeHistory": true,
        "customPatterns": true
      }
    },
    {
      "id": "container-scan",
      "name": "Container Security Scan",
      "type": "security-scan",
      "description": "Scan container images and configurations for vulnerabilities",
      "assignTo": "security-scanner",
      "priority": "high",
      "timeout": 1200000,
      "condition": "containerized === true",
      "input": {
        "images": "auto-detect",
        "configFiles": ["Dockerfile", "docker-compose.yml"],
        "compliance": ["CIS-Docker"]
      }
    },
    {
      "id": "infrastructure-scan",
      "name": "Infrastructure Security Assessment",
      "type": "security-scan",
      "description": "Assess infrastructure configuration and security posture",
      "assignTo": "security-scanner",
      "depends": ["static-analysis"],
      "priority": "high",
      "timeout": 1500000,
      "input": {
        "terraformFiles": "auto-detect",
        "kubernetesManifests": "auto-detect",
        "cloudProvider": "auto-detect"
      }
    },
    {
      "id": "threat-modeling",
      "name": "Threat Model Creation",
      "type": "threat-analysis",
      "description": "Create comprehensive threat model using STRIDE methodology",
      "assignTo": "security-analyst",
      "depends": ["static-analysis", "dependency-scan"],
      "priority": "high",
      "timeout": 2400000,
      "input": {
        "applicationArchitecture": "${static-analysis.output.architecture}",
        "vulnerabilities": "${static-analysis.output.vulnerabilities}",
        "dependencies": "${dependency-scan.output.dependencies}"
      }
    },
    {
      "id": "penetration-testing",
      "name": "Automated Penetration Testing",
      "type": "security-test",
      "description": "Conduct automated penetration testing on running application",
      "assignTo": "security-analyst",
      "depends": ["threat-modeling"],
      "priority": "medium",
      "timeout": 3600000,
      "condition": "${environmentType} !== 'production'",
      "input": {
        "targetURL": "${targetApplication}",
        "threatModel": "${threat-modeling.output.threatModel}",
        "testScope": "owasp-top-10"
      }
    },
    {
      "id": "compliance-check",
      "name": "Compliance Assessment",
      "type": "compliance-review",
      "description": "Verify compliance with security frameworks and regulations",
      "assignTo": "compliance-officer",
      "depends": ["threat-modeling", "infrastructure-scan"],
      "priority": "medium",
      "timeout": 1800000,
      "input": {
        "framework": "${complianceFramework}",
        "securityFindings": "${static-analysis.output.findings}",
        "threatModel": "${threat-modeling.output.threatModel}"
      }
    },
    {
      "id": "vulnerability-prioritization",
      "name": "Vulnerability Risk Assessment",
      "type": "risk-analysis",
      "description": "Prioritize identified vulnerabilities based on risk and exploitability",
      "assignTo": "security-analyst",
      "depends": ["penetration-testing", "compliance-check"],
      "priority": "high",
      "timeout": 1200000,
      "input": {
        "vulnerabilities": "all_findings",
        "businessContext": "${targetApplication}",
        "riskFramework": "CVSS"
      }
    },
    {
      "id": "remediation-plan",
      "name": "Security Remediation Planning",
      "type": "planning",
      "description": "Create detailed remediation plan with timelines and responsibilities",
      "assignTo": "security-analyst",
      "depends": ["vulnerability-prioritization"],
      "priority": "medium",
      "timeout": 1800000,
      "input": {
        "prioritizedVulnerabilities": "${vulnerability-prioritization.output.prioritized}",
        "availableResources": "auto-assess",
        "timeline": "30-60-90-days"
      }
    },
    {
      "id": "security-report",
      "name": "Comprehensive Security Report",
      "type": "reporting",
      "description": "Generate executive and technical security assessment reports",
      "assignTo": "security-analyst",
      "depends": ["remediation-plan"],
      "priority": "medium",
      "timeout": 1200000,
      "input": {
        "findings": "all_outputs",
        "remediationPlan": "${remediation-plan.output.plan}",
        "audienceTypes": ["executive", "technical", "compliance"]
      }
    }
  ],
  "settings": {
    "maxConcurrency": 3,
    "timeout": 14400000,
    "retryPolicy": "exponential",
    "failurePolicy": "continue"
  },
  "metadata": {
    "author": "Cortex OS Security Team",
    "created": "2025-01-28",
    "tags": [
      "security",
      "audit",
      "vulnerability",
      "compliance",
      "sast",
      "dast"
    ],
    "complexity": "complex",
    "estimatedDuration": 14400000,
    "prerequisites": [
      "target application access",
      "security tools configuration"
    ],
    "outputs": [
      "security report",
      "vulnerability database",
      "remediation plan"
    ],
    "compliance": ["OWASP", "NIST", "ISO27001"],
    "version": "1.0.0"
  }
}
