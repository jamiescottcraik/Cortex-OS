#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
. "$(dirname -- "$0")/common.sh"
echo "Running pre-commit checks..."

CHANGED_FILES=$(git diff --cached --name-only | wc -l | tr -d ' ')
if [ "$CHANGED_FILES" -gt 15 ] && [ ! -f .structure-override ]; then
  echo "Too many files ($CHANGED_FILES). Use override."
  exit 1
fi

git diff --cached --name-only | xargs pnpm structure:validate --files || exit 1
pnpm madge --circular --extensions ts,tsx ./packages ./apps || true
pnpm lint-staged || true
pnpm turbo typecheck --filter="...HEAD^" || true
