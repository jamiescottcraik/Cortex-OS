{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$id": "https://cortex-os.dev/schemas/devops.plan.schema.json",
	"title": "DevOps Plan",
	"type": "object",
	"required": ["version", "environments", "services"],
	"properties": {
		"version": {
			"type": "string",
			"pattern": "^v?[0-9]+\\.[0-9]+\\.[0-9]+$"
		},
		"owner": { "type": "string", "minLength": 1 },
		"environments": {
			"type": "array",
			"minItems": 1,
			"items": {
				"type": "object",
				"required": ["name", "region", "compliance"],
				"properties": {
					"name": {
						"type": "string",
						"pattern": "^(dev|staging|prod|qa|sandbox)$"
					},
					"region": { "type": "string", "minLength": 2 },
					"compliance": {
						"type": "object",
						"required": ["pii", "data_residency"],
						"properties": {
							"pii": { "type": "boolean" },
							"data_residency": { "type": "string", "minLength": 2 }
						},
						"additionalProperties": false
					}
				},
				"additionalProperties": false
			}
		},
		"services": {
			"type": "array",
			"minItems": 1,
			"items": {
				"type": "object",
				"required": ["name", "image", "replicas"],
				"properties": {
					"name": { "type": "string", "minLength": 1 },
					"image": { "type": "string", "minLength": 3 },
					"replicas": { "type": "integer", "minimum": 1 },
					"resources": {
						"type": "object",
						"properties": {
							"cpu": { "type": "string" },
							"memory": { "type": "string" }
						},
						"additionalProperties": false
					},
					"env": {
						"type": "object",
						"additionalProperties": {
							"oneOf": [
								{ "type": "string" },
								{ "type": "number" },
								{ "type": "boolean" }
							]
						}
					}
				},
				"additionalProperties": false
			}
		}
	},
	"additionalProperties": false
}
